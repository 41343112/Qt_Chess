# 被吃棋子堆疊顯示效果示意 (Captured Pieces Stacking Visual Guide)

## 視覺效果對比 (Visual Comparison)

### 改進前 (Before)

```
┌────────────────────────────────┐
│     被吃棋子 (按吃子順序)      │
│                                │
│   白方吃掉: ♛ ♜ ♞ ♟ ♟ ♜      │
│   (完全分開，間距明顯)          │
│                                │
│   分數顯示:                     │
│   白方: 21                     │
│   黑方: 8                      │
│   (無分差顯示)                  │
└────────────────────────────────┘
```

### 改進後 (After)

```
┌────────────────────────────────┐
│  被吃棋子 (按價值排序 + 堆疊)   │
│                                │
│   白方吃掉: ♟♟♞♜♜♛            │
│   (部分重疊，視覺更緊湊)        │
│                                │
│   分數顯示:                     │
│   白方: 21 (+13)               │
│   黑方: 8                      │
│   (顯示13分優勢)                │
└────────────────────────────────┘
```

## 排序邏輯示範 (Sorting Logic Example)

### 場景 1: 多種棋子被吃

**吃子順序 (Capture Order):**
1. 第1步: 吃掉皇后 ♛ (價值 9)
2. 第2步: 吃掉城堡 ♜ (價值 5)
3. 第3步: 吃掉騎士 ♞ (價值 3)
4. 第4步: 吃掉兵 ♟ (價值 1)
5. 第5步: 吃掉兵 ♟ (價值 1)
6. 第6步: 吃掉城堡 ♜ (價值 5)

**改進前顯示 (Before):**
```
♛ ♜ ♞ ♟ ♟ ♜
```
(按照吃子的時間順序)

**改進後顯示 (After):**
```
♟♟♞♜♜♛
```
(按照價值從小到大: 1, 1, 3, 5, 5, 9)

### 場景 2: 相同價值的棋子

**吃子順序:**
1. 騎士 ♞ (價值 3)
2. 兵 ♟ (價值 1)
3. 主教 ♗ (價值 3)
4. 兵 ♟ (價值 1)

**改進前顯示:**
```
♞ ♟ ♗ ♟
```

**改進後顯示:**
```
♟♟♗♞
```
說明: 兵 (1) < 主教/騎士 (3)，相同價值的棋子按類型排序

### 場景 3: 只有低價值棋子

**吃子順序:**
1. 兵 ♟
2. 兵 ♟
3. 兵 ♟

**改進前顯示:**
```
♟ ♟ ♟
```

**改進後顯示:**
```
♟♟♟
```
(價值相同，排序後順序可能改變，但使用堆疊效果)

## 堆疊效果詳解 (Stacking Effect Details)

### 重疊距離說明

**常數定義:**
```cpp
const int CAPTURED_PIECE_OVERLAP_PX = -8;  // 負8像素表示向左偏移8px
```

**視覺示意 (假設每個棋子符號寬度約16px):**

```
無重疊 (間距0px):
♟    ♞    ♜    ♛
|16px||16px||16px||16px|
總寬度: 64px

輕微重疊 (-4px):
♟  ♞  ♜  ♛
|16px|
    |-4px overlap|
總寬度: 52px

中等重疊 (-8px, 當前設定):
♟ ♞ ♜ ♛
|16px|
    |-8px overlap|
總寬度: 40px

重度重疊 (-12px):
♟♞♜♛
|16px|
    |-12px overlap|
總寬度: 28px
```

### HTML/CSS 實現

**生成的 HTML 代碼示例:**
```html
<div style='display: inline;'>
    <span>♟</span>
    <span style='margin-left: -8px;'>♟</span>
    <span style='margin-left: -8px;'>♞</span>
    <span style='margin-left: -8px;'>♜</span>
    <span style='margin-left: -8px;'>♜</span>
    <span style='margin-left: -8px;'>♛</span>
</div>
```

**渲染效果:**
- 第一個棋子 `♟` 完整顯示
- 第二個棋子 `♟` 向左偏移8px，與第一個部分重疊
- 依此類推，形成從左到右的堆疊效果

## 分數差異顯示 (Score Difference Display)

### 顯示規則

1. **白方領先 (White Ahead)**
   ```
   白方: 15 (+7)  ← 顯示優勢
   黑方: 8
   ```

2. **黑方領先 (Black Ahead)**
   ```
   白方: 5
   黑方: 12 (+7)  ← 顯示優勢
   ```

3. **勢均力敵 (Equal)**
   ```
   白方: 10
   黑方: 10
   ```

### 實際對局範例

**棋局狀態:**
- 白方吃掉: 兵(1) + 兵(1) + 騎士(3) + 城堡(5) = 10分
- 黑方吃掉: 兵(1) + 主教(3) = 4分

**顯示效果:**
```
┌─────────────────────────────┐
│ 吃子分數                     │
│                             │
│ 白方: 10 (+6)  ← 領先6分    │
│ 黑方: 4                     │
└─────────────────────────────┘

┌─────────────────────────────┐
│ 被吃棋子                     │
│                             │
│ 白方吃掉: ♟♟♞♜  (黑子)     │
│ 黑方吃掉: ♙♗    (白子)     │
└─────────────────────────────┘
```

## 完整界面佈局 (Complete UI Layout)

```
┌──────────────────────────────────────────────────────┐
│                     Qt Chess                         │
├────────┬──────────────────────────────┬──────────────┤
│        │                              │              │
│ 棋譜    │  ┌──────────────────────┐  │  吃子分數    │
│ 列表    │  │  黑方時間: 10:00    │  │              │
│        │  │  ♙♗              │  │  白方: 10(+6)│
│ 1.e4   │  └──────────────────────┘  │  黑方: 4     │
│ 1...e5 │                              │              │
│ 2.Nf3  │        ┌──────────┐         │  時間控制    │
│ 2...Nc6│        │          │         │              │
│ 3.Bb5  │        │  棋盤     │         │  白方: 10分  │
│        │        │          │         │  黑方: 10分  │
│        │        │          │         │  增量: 0秒   │
│        │        └──────────┘         │              │
│        │                              │  [開始計時]  │
│        │  ┌──────────────────────┐  │              │
│ 回放    │  │  ♟♟♞♜            │  │              │
│ 控制    │  │  白方時間: 10:00    │  │              │
│        │  └──────────────────────┘  │              │
│ ⏮◀▶⏭  │                              │              │
└────────┴──────────────────────────────┴──────────────┘
```

### 被吃棋子位置說明

- **左側黑方時間標籤下方**: 顯示黑方吃掉的白方棋子 (♙♗)
- **右側白方時間標籤上方**: 顯示白方吃掉的黑方棋子 (♟♟♞♜)

## 測試場景效果 (Test Scenario Effects)

### 測試 1: 學者殺局 (Scholar's Mate)

**棋步:**
1. e4 e5
2. Bc4 Nc6
3. Qh5 Nf6
4. Qxf7# (將殺)

**被吃棋子:**
- 白方吃掉黑方兵 ♟ (在f7)

**顯示效果:**
```
白方吃掉: ♟
分數: 白方: 1 (+1) / 黑方: 0
```

### 測試 2: 王后對攻 (Queen Exchange)

**被吃棋子:**
1. 白方吃掉黑方皇后 ♛ (9分)
2. 黑方吃掉白方皇后 ♕ (9分)

**改進前顯示:**
```
白方吃掉: ♛
黑方吃掉: ♕
分數: 白方: 9 / 黑方: 9
```

**改進後顯示:**
```
白方吃掉: ♛
黑方吃掉: ♕
分數: 白方: 9 / 黑方: 9 (無分差顯示)
```

### 測試 3: 複雜對局 (Complex Game)

**白方吃掉 (順序):**
皇后 ♛, 兵 ♟, 城堡 ♜, 騎士 ♞, 主教 ♝, 兵 ♟, 城堡 ♜

**改進前顯示:**
```
♛ ♟ ♜ ♞ ♝ ♟ ♜
分數: 白方: 26
```

**改進後顯示:**
```
♟♟♞♝♜♜♛
分數: 白方: 26 (+X)  (假設黑方吃了Y分)
```

排序結果:
- 兵 ♟ (1) × 2
- 騎士 ♞ (3) × 1
- 主教 ♝ (3) × 1
- 城堡 ♜ (5) × 2
- 皇后 ♛ (9) × 1
總分: 26

## 可調整參數說明 (Adjustable Parameters)

### 修改重疊量

在 `qt_chess.cpp` 中找到以下常數:

```cpp
const int CAPTURED_PIECE_OVERLAP_PX = -8;
```

**可選值:**
- `-4`: 輕微重疊，棋子較分開
- `-8`: 中等重疊（當前設定，推薦）
- `-12`: 重度重疊，棋子很緊湊
- `0`: 無重疊，棋子完全分開

### 修改後效果預覽

**-4px (輕微重疊):**
```
♟  ♟  ♞  ♜  ♜  ♛
```

**-8px (中等重疊, 當前):**
```
♟ ♟ ♞ ♜ ♜ ♛
```

**-12px (重度重疊):**
```
♟♟♞♜♜♛
```

## 相容性說明 (Compatibility Notes)

### Unicode 支援

**需要的棋子符號:**
- 白方: ♔ ♕ ♖ ♗ ♘ ♙
- 黑方: ♚ ♛ ♜ ♝ ♞ ♟

**字體要求:**
- 系統需要支援 Unicode 棋子符號的字體
- 常見支援字體: Arial Unicode MS, Segoe UI Symbol, Noto Sans

### HTML/CSS 支援

**Qt 版本要求:**
- Qt 5.x 或更高版本
- 支援 QLabel 的 Qt::RichText 格式
- 支援基本的 HTML/CSS 樣式

### 跨平台測試

**Windows:**
✓ 完全支援
✓ Unicode 棋子符號顯示正常
✓ HTML 負邊距效果正常

**macOS:**
✓ 完全支援
✓ 可能需要調整字體大小以匹配系統字體

**Linux:**
✓ 完全支援
✓ 確保安裝了支援 Unicode 的字體

## 效能考量 (Performance Considerations)

### 排序複雜度

**std::sort 時間複雜度:**
- O(n log n)，其中 n 是被吃棋子的數量
- 對於典型的象棋對局，n < 16（每方最多吃16個棋子）
- 實際效能影響: 可忽略不計（< 1ms）

### HTML 生成開銷

**字串拼接:**
- 每次更新需要生成 HTML 字串
- 對於 n 個棋子，生成 n 個 span 標籤
- 實際效能影響: 可忽略不計（< 1ms）

### 更新頻率

**何時觸發更新:**
- 每次吃子後調用 `updateBoard()`
- 回放時移動到新位置
- 新遊戲開始時重置

**優化策略:**
- 只在真正需要時更新（已實現）
- 使用 Qt::RichText 格式的緩存（Qt 內部處理）

## 未來改進方向 (Future Enhancements)

### 1. 動畫效果
- 新吃的棋子滑入動畫
- 重新排序時的過渡動畫

### 2. 互動功能
- 滑鼠懸停顯示棋子詳情
- 點擊棋子高亮該棋子被吃的棋步

### 3. 視覺增強
- 為不同價值的棋子添加顏色邊框
- 根據棋子價值調整大小

### 4. 響應式設計
- 根據視窗大小動態調整重疊量
- 在小視窗下縮小棋子符號

### 5. 統計功能
- 顯示吃子類型統計
- 顯示總價值趨勢圖
