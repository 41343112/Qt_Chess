# Qt_Chess

使用 Qt5 開發的功能完整的西洋棋遊戲，支援雙人對戰、AI 人機對弈和線上對戰。

## 功能特色

- **完整的西洋棋實現**：所有棋子（國王、皇后、城堡、主教、騎士、兵）都具有正確的移動規則
- **特殊走法**：
  - **王車易位**：在符合條件的情況下，國王可以與城堡進行易位（王翼或后翼）
  - **兵升變**：兵到達棋盤對面終點時會升變，可透過對話框選擇升變為皇后、城堡、主教或騎士
  - **吃過路兵**：當對手的兵從起始位置前進兩格並停在您的兵旁邊時，可以進行特殊吃子
- **回合制遊戲**：白棋和黑棋輪流下棋
- **走法驗證**：只允許合法的走法
- **將軍偵測**：遊戲會偵測國王是否被將軍
- **將死和僵局偵測**：遊戲會自動偵測結束條件
- **視覺化提示**：選中的棋子和有效移動位置會被標示（橙色表示普通移動，紅色表示吃子移動）
- **簡潔的使用者介面**：經典棋盤配合 Unicode 棋子符號
- **新遊戲**：隨時重置棋盤開始新遊戲
- **放棄/認輸**：遊戲進行中可以選擇放棄，認輸結果會記錄在棋譜中
- **線上對戰模式** 🆕：
  - **使用中央伺服器**：透過 WebSocket 連接到 chess-server-mjg6.onrender.com
  - **超簡單連線**：只需要房號，無需IP地址或網路設定
  - **跨網路對弈**：可以與世界各地的朋友對弈
  - **無需設定**：不需要路由器端口轉發或防火牆設定
  - **房號系統**：伺服器自動生成唯一房號，複製貼上即可分享
  - **即時棋步同步**：所有移動自動在雙方裝置間同步
  - **自動配色**：房主執白棋，加入者執黑棋
  - **棋盤自動翻轉**：黑棋玩家的棋盤會自動翻轉
  - **連線狀態顯示**：即時顯示連線狀態和房間資訊
  - **斷線處理**：自動偵測並處理對手斷線情況
  - 📖 [簡易使用指南（給初學者）](docs/ONLINE_BEGINNER_GUIDE.md) - 最簡單的連線教學
  - 📖 [完整技術文檔](docs/ONLINE_MODE_FEATURE.md) - 詳細功能說明
  - 📖 [伺服器遷移說明](docs/SERVER_MIGRATION.md) - 從P2P到中央伺服器的變更說明
- **AI 人機對弈**：
  - 整合 Stockfish 西洋棋引擎，支援人機對弈模式
  - 選擇執白棋或執黑棋與電腦對戰
  - 可調整電腦難度等級（0-20），從初學者到大師級別
  - 電腦思考時會顯示「電腦思考中...」提示
  - 執黑棋時棋盤會自動翻轉
- **時間控制**：
  - 可選擇無限制或 30 秒至 60 分鐘的對局時間
  - 每著加秒功能（0-60 秒增量）
  - 雙方計時器即時顯示剩餘時間
  - 當前輪到的玩家計時器以綠色背景高亮顯示
  - 超時自動判負
  - 時間控制設定會在程式關閉後持續保存
  - 參閱 [TIME_CONTROL_FEATURE.md](docs/TIME_CONTROL_FEATURE.md) 以獲得技術細節
  - 參閱 [TIMER_COUNTDOWN_LOGIC.md](docs/TIMER_COUNTDOWN_LOGIC.md) 以了解雙人模式和電腦模式的時間倒數邏輯
- **音效**：移動、吃子、王車易位、將軍和將死都有不同的音效
- **可自訂的音效設定**：
  - 為每種事件類型設定自訂的音效檔案
  - 獨立調整每種音效的音量
  - 啟用/停用個別音效或所有音效
  - 獨立重設個別音效為預設值
  - 在套用設定前預覽音效
  - 設定會在程式關閉後持續保存
- **可自訂的棋子圖標**：
  - 從多種圖標集選項中選擇：
    - 預設的 Unicode 棋子符號
    - 三組預設圖標集（需要提供圖片）
    - 完全自訂的使用者選擇圖標
  - **可調整棋子大小**：使用方便的滑桿將棋子圖標從 60% 縮放到 100% 的方格大小
  - 為 12 種棋子類型（6 種白棋 + 6 種黑棋）設定自訂圖標
  - 支援常見的圖片格式（PNG、JPG、SVG、BMP）
  - 在套用前預覽圖標
  - 輕鬆切換不同的圖標集
  - 隨時重設為預設的 Unicode 符號
  - 設定會在程式關閉後持續保存
  - 參閱 [ADDING_ICON_SETS.md](docs/ADDING_ICON_SETS.md) 以了解如何新增預設圖標圖片
- **可自訂的棋盤顏色**：
  - 從多種配色方案選項中選擇：
    - 經典棕褐色 - 傳統的棋盤外觀
    - 藍灰配色 - 現代冷色調風格
    - 綠白配色 - 清新自然的外觀
    - 紫粉配色 - 優雅的紫色和粉紅色調
    - 木紋深色 - 豐富的木質棕色與深色對比
    - 海洋藍配色 - 深海洋藍與淺藍對比
    - 淺色系 - 非常淺的粉彩色，營造柔和簡約的外觀
    - 使用顏色選擇器完全自訂顏色
  - **2×2 預覽網格**：在套用前準確看到棋盤的外觀
  - **預設縮圖**：所有七種預設配色方案的視覺預覽
  - 為淺色和深色方格挑選任何自訂顏色
  - 隨時重設為預設顏色
  - 設定會在程式關閉後持續保存
  - 參閱 [BOARD_COLOR_QUICK_START.md](docs/BOARD_COLOR_QUICK_START.md) 以獲得使用指南
- **棋盤反轉功能**：
  - 將棋盤旋轉 180 度，從任一玩家的視角觀看
  - 非常適合玩家坐在對面的雙人遊戲
  - 透過設定選單 → "反轉棋盤" 存取
  - 反轉時所有互動（點擊、拖放、標示）都能正常運作
  - 棋盤反轉狀態會在程式關閉後持續保存
  - 參閱 [BOARD_FLIP_FEATURE.md](docs/BOARD_FLIP_FEATURE.md) 以獲得技術細節
- **棋譜記錄與回放**：
  - **自動記錄棋譜**：每一步移動都會自動記錄，包括完整的代數記譜法
  - **認輸記錄**：玩家認輸時會正確記錄在遊戲結果中，並反映在 PGN 輸出中
  - **PGN 匯出**：將完整的對局匯出為標準 PGN 格式檔案
  - **棋譜複製**：快速將棋譜複製到剪貼簿以便分享或分析
  - **遊戲回放功能**：
    - **遊戲進行中或結束後都可以回放整局對弈**
    - 雙擊棋譜列表中的任一步進入回放模式
    - 使用導航按鈕（⏮ ◀ ▶ ⏭）逐步前後查看棋局
    - 回放模式中會高亮當前棋步在棋譜列表中的位置
    - 回放時棋盤互動被停用，防止意外修改
    - **遊戲進行中回放時計時器自動暫停**
    - 點擊「退出回放」返回當前遊戲狀態並繼續對弈
    - **計時器在退出回放後自動恢復**
- **自動更新功能**：
  - **啟動時自動檢查更新**：應用程式啟動後自動檢查 GitHub 上的最新版本
  - **手動檢查更新**：透過「說明」選單中的「檢查更新」選項手動檢查
  - **版本比較**：智慧比較版本號，確保檢測到最新版本
  - **更新通知**：發現新版本時顯示更新說明並提供下載連結
  - **一鍵下載**：可以直接開啟瀏覽器前往 GitHub 發行頁面下載
  - 參閱 [AUTO_UPDATE_FEATURE.md](docs/AUTO_UPDATE_FEATURE.md) 以獲得技術細節
- **地雷模式** 🆕：
  - **創新遊戲模式**：結合西洋棋與地雷遊戲元素的獨特玩法
  - **地雷區域**：棋盤第 3-6 行、a-h 列（4×8 格子）設有地雷區
  - **隨機地雷**：每局隨機放置 4-5 個地雷
  - **九宮格提示**：顯示周圍格子的地雷數量，使用顏色編碼（藍、綠、紅、紫）
  - **地雷觸發**：棋子踩到地雷會被立即移除
  - **視覺標示**：地雷區域使用橙紅色邊框標示
  - **漸進顯示**：只有踩過的格子才會顯示地雷數量
  - 📖 [地雷模式完整說明](docs/MINESWEEPER_MODE.md) - 詳細規則與策略

## 建置方式

### 需求條件
- Qt5（qt5-qtbase-devel 或 qtbase5-dev）
- **Qt5 WebSockets**（線上對戰功能必需，詳見下方安裝說明）
- 支援 C++17 的編譯器
- qmake

### 安裝 Qt WebSockets 模組

線上對戰模式需要 Qt WebSockets 模組，此模組可能不包含在預設安裝中。

**Ubuntu/Debian:**
```bash
sudo apt-get install libqt5websockets5-dev
```

**Fedora/RHEL:**
```bash
sudo dnf install qt5-qtwebsockets-devel
```

**Arch Linux:**
```bash
sudo pacman -S qt5-websockets
```

**macOS (Homebrew):**
```bash
brew install qt5  # WebSockets 已包含
```

**Windows:**
使用 Qt Maintenance Tool 安裝 WebSockets 元件

📖 **詳細建置說明請參閱 [BUILDING.md](BUILDING.md)**

### 建置指令
```bash
qmake Qt_Chess.pro
make
```

### 執行
```bash
./Qt_Chess
```

## 如何遊玩

1. **選擇遊戲模式**：
   - **雙人對弈**：點擊「雙人」按鈕進行本地雙人對戰
   - **電腦對弈**：點擊「電腦」按鈕與 AI 對戰
     - 選擇「執白」或「執黑」決定您的棋子顏色
     - 使用「電腦難度」滑桿調整 AI 強度（0-20）
     - 執黑棋時棋盤會自動翻轉
   - **線上對戰** 🆕：點擊「線上」按鈕進行網路對戰（[查看簡易指南](docs/ONLINE_BEGINNER_GUIDE.md)）
     - **使用中央伺服器，無需網路設定**
     - **創建房間（超簡單）**：
       1. 選擇「我要創建房間」
       2. 點擊「複製房號」
       3. 用LINE/WeChat等通訊軟體把房號傳給朋友
       4. 等待朋友加入
     - **加入房間（超簡單）**：
       1. 複製朋友給的房號
       2. 選擇「我有房號」
       3. 點擊「從剪貼簿貼上」
       4. 點擊「開始」
     - 房主執白棋，加入者執黑棋
     - 所有棋步會自動同步到對手裝置
     - 可與世界各地的朋友對弈
   - **地雷模式** 🆕：點擊「💣 地雷模式」按鈕進行地雷遊戲變體（[查看完整說明](docs/MINESWEEPER_MODE.md)）
     - 棋盤第 3-6 行、a-h 列區域設有地雷（橙紅色邊框標示）
     - 每局隨機放置 4-5 個地雷
     - 棋子移動後顯示周圍格子的地雷數量（使用顏色編碼）
     - 踩到地雷的棋子會被立即移除
     - 根據顯示的地雷數量推測並避免踩雷
2. **時間控制設定**：
   - 從「總時間」下拉選單選擇對局時間（無限制、30 秒至 60 分鐘）
   - 使用「每著加秒」滑桿設定每步增加的時間（0-60 秒）
   - 計時器會在第一步棋走出後開始
   - 當前輪到的玩家計時器以綠色高亮顯示
3. **選擇棋子**：點擊您的其中一個棋子（白棋先走）
4. **拖放**：點擊並拖曳棋子到有效的方格
5. **取消移動**：在拖曳過程中隨時按右鍵取消並將棋子放回原位
6. **有效移動**：有效的目標方格會被標示（橙色表示普通移動，紅色表示吃子移動）
7. **移動**：點擊標示的方格來移動棋子，或者拖放
8. **取消選擇**：再次點擊選中的棋子或按右鍵取消選擇
9. **回合指示**：目前玩家的回合會顯示在頂部
10. **遊戲狀態**：將軍、將死和僵局會自動偵測並顯示
11. **新遊戲**：點擊「新遊戲」按鈕或選擇「遊戲」選單 >「新遊戲」重置棋盤
12. **放棄/認輸**：遊戲進行中點擊「放棄」按鈕或選擇「遊戲」選單 >「放棄」認輸
13. **音效設定**：點擊「設定」選單 >「音效設定」以進行：
    - 為每個事件（移動、吃子、王車易位、將軍、將死）選擇自訂音效檔案
    - 使用滑桿調整音量
    - 啟用/停用個別音效或所有音效
    - 使用每個音效旁邊的「重設」按鈕將個別音效重設為預設值
    - 使用「重設為預設值」按鈕一次重設所有音效
    - 在套用設定前預覽音效
    - **支援的音訊格式**：WAV（建議）、MP3、OGG
      - 建議使用 WAV 格式以獲得所有平台的最佳相容性
14. **棋子圖標設定**：點擊「設定」選單 >「棋子圖標設定」以進行：
    - 從多種圖標集選項中選擇：
      - 預設的 Unicode 棋子符號（♔、♕、♖ 等）
      - 三組預設圖標集（如果可用）
      - 自訂使用者選擇的圖標
    - **調整棋子大小**：使用滑桿將棋子從 60% 縮放到 100% 的方格大小（預設 80%）
    - 為每種棋子類型（白棋和黑棋）上傳自訂圖片檔案
    - 在套用前預覽圖標
    - 使用「重設」按鈕將個別棋子圖標重設為預設的 Unicode 符號
    - 使用「重設為預設值」按鈕一次重設所有棋子圖標
    - **支援的圖片格式**：PNG、JPG、SVG、BMP
      - 建議使用透明背景的 PNG 格式以獲得最佳外觀
15. **棋盤顏色設定**：點擊「設定」選單 >「棋盤顏色設定」以進行：
    - 從七種預設配色方案中選擇：
      - 經典棕褐色 - 傳統的棕色和米色
      - 藍灰配色 - 現代的藍色和灰色調
      - 綠白配色 - 清新的綠色和白色組合
      - 紫粉配色 - 優雅的紫色和粉紅色調
      - 木紋深色 - 豐富的木質棕色與深色對比
      - 海洋藍配色 - 深海洋藍與淺藍對比
      - 淺色系 - 非常淺的粉彩色，營造柔和簡約的外觀
    - 使用顏色選擇器建立自訂配色方案
    - 查看 2×2 預覽網格，準確了解您的棋盤外觀
    - 查看所有預設配色方案的縮圖預覽
    - 隨時重設為預設顏色
    - 所有顏色設定會自動儲存
16. **棋盤反轉**：點擊「設定」選單 >「反轉棋盤」以進行：
    - 將棋盤旋轉 180 度，從任一玩家的視角觀看
    - 非常適合玩家坐在對面的雙人遊戲
    - 再次點擊以恢復原始方向
    - 反轉時所有遊戲互動（點擊、拖曳、標示）都能正常運作
    - 棋盤方向會在程式關閉後儲存並恢復
17. **棋譜與回放**：
    - **查看棋譜**：左側面板會即時顯示所有已走的棋步，使用標準代數記譜法
    - **匯出 PGN**：遊戲結束後點擊「匯出 PGN」按鈕將完整對局儲存為 PGN 檔案
    - **複製棋譜**：點擊「複製棋譜」按鈕將棋譜複製到剪貼簿
    - **回放對局**：**遊戲進行中或結束後**雙擊棋譜列表中的任一步進入回放模式
    - **導航回放**：
      - 使用 ⏮ 按鈕跳到棋局開始（初始狀態）
      - 使用 ◀ 按鈕回到上一步
      - 使用 ▶ 按鈕前進到下一步
      - 使用 ⏭ 按鈕跳到棋局結束（最後一步）
    - **遊戲進行中回放**：
      - 回放時計時器自動暫停
      - 點擊「退出回放」按鈕返回當前遊戲狀態
      - 計時器自動恢復，繼續對弈
    - 回放模式中棋盤互動被停用，棋譜列表會高亮顯示當前回放的棋步
18. **自動更新**：
    - **自動檢查**：應用程式啟動後會自動檢查是否有新版本可用
    - **手動檢查**：點擊「說明」選單 >「檢查更新」手動檢查更新
    - **更新通知**：發現新版本時會顯示版本資訊和更新說明
    - **下載新版本**：點擊「前往下載」按鈕直接開啟瀏覽器到 GitHub 發行頁面
    - **靜默檢查**：自動檢查時如果沒有新版本則不會打擾使用者

## 遊戲規則

- 白棋總是先走
- 玩家輪流下棋
- 每個棋子根據標準西洋棋規則移動：
  - **兵**：向前移動一格（首次移動可走兩格），斜向吃子
  - **城堡**：水平或垂直移動任意格數
  - **騎士**：以「L」形移動（一個方向移動 2 格，垂直方向移動 1 格）
  - **主教**：斜向移動任意格數
  - **皇后**：水平、垂直或斜向移動任意格數
  - **國王**：向任何方向移動一格
- **特殊走法**：
  - **王車易位**：如果國王和城堡都沒有移動過、它們之間沒有棋子、國王不在被將軍狀態、且國王不會經過或進入被將軍的位置，則國王和城堡可以進行易位
  - **兵升變**：當兵到達棋盤對面終點（白棋為第 0 列，黑棋為第 7 列）時，必須升變為皇后、城堡、主教或騎士
  - **吃過路兵**：如果對手的兵從起始位置前進兩格並停在您的兵旁邊，您可以在下一步「順道」吃掉它
- 您不能走入被將軍的位置
- 遊戲在將死或僵局時結束

## 專案結構

- `main.cpp` - 應用程式進入點
- `qt_chess.h/cpp` - 主視窗和 UI 邏輯
- `chessboard.h/cpp` - 遊戲棋盤邏輯和規則
- `chesspiece.h/cpp` - 棋子定義和移動驗證
- `chessengine.h/cpp` - Stockfish 引擎整合，支援人機對弈
- `soundsettingsdialog.h/cpp` - 自訂音訊的音效設定對話框
- `pieceiconsettingsdialog.h/cpp` - 自訂棋子圖形的圖標設定對話框
- `boardcolorsettingsdialog.h/cpp` - 自訂棋盤顏色的顏色設定對話框
- `qt_chess.ui` - Qt UI 設計檔案
- `resources.qrc` - 嵌入音效檔案的 Qt 資源檔案
- `engine/` - Stockfish 西洋棋引擎目錄

## 授權條款

這是一個用於學習 Qt 和遊戲開發的教育專案。