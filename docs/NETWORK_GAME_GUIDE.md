# 網路對戰功能使用說明

## 功能概述

Qt_Chess 現在支援網路對戰功能，允許兩個玩家通過 TCP/IP 網路連線進行對弈。無論玩家是在同一局域網內還是跨越不同網域，只要能夠建立網路連線，就可以進行對戰。

## 功能特點

- **點對點連線**：使用 TCP 協議建立穩定的點對點連線
- **主機/客戶端模式**：一方作為主機（伺服器）等待連線，另一方作為客戶端連接
- **即時棋步同步**：所有移動即時同步到對手
- **選邊功能**：主機可以選擇執白或執黑
- **連線狀態顯示**：即時顯示連線狀態和對手資訊
- **認輸同步**：認輸訊息即時傳送給對手
- **新遊戲請求**：可以向對手發送新遊戲請求

## 使用方法

### 1. 主機模式（等待其他玩家連線）

1. 啟動遊戲
2. 在右側控制面板選擇「🌐 網路」模式
3. 在彈出的對話框中選擇「主機模式」
4. 設定以下選項：
   - **玩家名稱**：輸入您的名稱
   - **端口**：設定伺服器端口（預設 8888）
   - **執棋顏色**：選擇執白或執黑
5. 查看並記下顯示的本機 IP 位址
6. 點擊「開始」按鈕
7. 等待對手連線
8. 當對手連線成功後，遊戲即可開始

**注意事項：**
- 確保防火牆允許指定端口的連線
- 如果對手在不同網域，需要進行端口轉發設定

### 2. 客戶端模式（連接到其他玩家）

1. 啟動遊戲
2. 在右側控制面板選擇「🌐 網路」模式
3. 在彈出的對話框中選擇「加入模式」
4. 設定以下選項：
   - **玩家名稱**：輸入您的名稱
   - **伺服器位址**：輸入主機的 IP 位址
   - **端口**：輸入主機設定的端口（預設 8888）
5. 點擊「開始」按鈕
6. 等待連線建立
7. 連線成功後，遊戲即可開始

### 3. 進行對弈

- 連線成功後，按照正常的西洋棋規則進行對弈
- 只能在輪到自己時移動棋子
- 所有移動會即時同步到對手的棋盤
- 可以使用「放棄」按鈕認輸
- 可以使用「新遊戲」按鈕請求開始新遊戲

### 4. 結束對戰

- 遊戲結束後，可以選擇：
  - 切換回其他模式（會自動斷開連線）
  - 請求新遊戲繼續對弈
  - 關閉應用程式

## 網路設定

### 同一局域網內對戰

如果兩個玩家在同一局域網內（例如同一 WiFi 網路），只需：
1. 主機查看本機 IP（通常格式為 192.168.x.x）
2. 客戶端輸入該 IP 位址即可連線

### 跨網域對戰

如果玩家在不同網域，需要額外設定：

#### 方式一：端口轉發（Port Forwarding）

1. 主機需要設定路由器的端口轉發：
   - 登入路由器管理頁面
   - 找到端口轉發或虛擬伺服器設定
   - 新增轉發規則：將外部端口（例如 8888）轉發到主機的內部 IP 和端口
   - 保存設定

2. 查詢主機的公網 IP：
   - 訪問 https://www.whatismyip.com/ 或類似網站
   - 記下顯示的 IP 位址

3. 客戶端使用主機的公網 IP 連線

#### 方式二：使用 VPN

1. 兩個玩家加入同一個虛擬局域網（例如 Hamachi、ZeroTier）
2. 使用虛擬局域網內的 IP 位址進行連線

#### 方式三：使用雲端伺服器

1. 在雲端伺服器（例如 AWS、Azure）上運行主機
2. 使用伺服器的公網 IP 進行連線

## 常見問題

### 連線失敗怎麼辦？

1. **檢查網路連線**：確保兩台電腦都能訪問網路
2. **檢查防火牆**：確保防火牆允許應用程式通訊
3. **檢查端口**：確保端口未被其他程式占用
4. **檢查 IP 位址**：確保輸入的 IP 位址正確
5. **檢查端口轉發**：如果跨網域，確保端口轉發設定正確

### 遊戲中途斷線怎麼辦？

- 如果連線中斷，遊戲會顯示錯誤訊息
- 需要重新建立連線並開始新遊戲
- 當前棋局無法恢復

### 延遲很高怎麼辦？

- 網路延遲取決於網路品質
- 嘗試使用更穩定的網路連線
- 減少網路上的其他活動

## 技術細節

### 網路協議

- 使用 TCP/IP 協議確保可靠傳輸
- 採用 JSON 格式封裝遊戲訊息
- 支援以下訊息類型：
  - 棋步移動
  - 遊戲開始
  - 遊戲結束
  - 認輸
  - 新遊戲請求
  - 玩家資訊

### 安全性

- 目前版本不包含加密功能
- 建議在受信任的網路環境中使用
- 未來版本可能會增加加密支援

### 連線穩定性

- 使用心跳機制檢測連線狀態
- 自動處理連線中斷
- 支援斷線重連（需手動操作）

## 建議和提示

1. **測試連線**：首次使用時，建議在同一局域網內測試
2. **記錄設定**：記下常用的 IP 和端口設定
3. **保持連線**：對弈期間保持網路連線穩定
4. **防火牆設定**：如遇連線問題，檢查防火牆設定
5. **端口選擇**：如果預設端口被占用，可以更改為其他端口（建議使用 1024-65535 範圍內的端口）

## 更新日誌

### Version 1.0（初版）
- 基本網路對戰功能
- 支援主機/客戶端模式
- 即時棋步同步
- 連線狀態顯示
