# 時間控制功能說明 (Time Control Feature)

## 功能概述 (Feature Overview)

本次更新為棋盤右側新增了時間控制設定面板，包含以下功能：

1. **總時間設定** - 可選擇無限制、30秒、1分鐘至60分鐘的對局時間
2. **每著加秒** - 可設定0-60秒的每步增加時間
3. **雙方計時器顯示** - 實時顯示黑白雙方剩餘時間

## UI 佈局 (UI Layout)

```
+------------------------------------------------------------------+
|  Menu: 設定 (Settings)                                            |
+------------------------------------------------------------------+
|                                                                  |
|  +----------------------------------+  +--------------------+    |
|  |                                  |  | 時間控制           |    |
|  |                                  |  |                    |    |
|  |         Chess Board              |  | 總時間:            |    |
|  |         (8x8 squares)            |  | [無限制 ▼]         |    |
|  |                                  |  |                    |    |
|  |                                  |  | 每著加秒:          |    |
|  |                                  |  | [0秒]              |    |
|  |                                  |  | |----o-----------|  |    |
|  |                                  |  |  0           60    |    |
|  |                                  |  |                    |    |
|  |                                  |  | 黑方時間:          |    |
|  |                                  |  | +----------------+ |    |
|  +----------------------------------+  | |    10:00       | |    |
|                                        | +----------------+ |    |
|  +----------------------------------+  |                    |    |
|  |         新遊戲 (New Game)         |  | 白方時間:          |    |
|  +----------------------------------+  | +----------------+ |    |
|                                        | |    10:00       | |    |
+----------------------------------------+ +----------------+ |    |
                                        +--------------------+    |
+------------------------------------------------------------------+
```

## 功能詳細說明 (Feature Details)

### 1. 時間限制選項 (Time Limit Options)

下拉選單提供以下選項：
- 無限制 (Unlimited)
- 30秒
- 1分鐘
- 3分鐘
- 5分鐘
- 10分鐘
- 15分鐘
- 30分鐘
- 60分鐘

### 2. 每著加秒滑桿 (Increment Slider)

- 範圍：0-60秒
- 刻度間隔：5秒
- 實時顯示當前設定值

### 3. 計時器顯示 (Timer Display)

- **黑方時間** - 顯示黑方剩餘時間 (mm:ss 格式)
- **白方時間** - 顯示白方剩餘時間 (mm:ss 格式)
- **活躍玩家高亮** - 當前輪到的玩家計時器以綠色背景顯示
- **非活躍玩家** - 以灰色背景顯示

### 4. 計時規則 (Timing Rules)

1. **開始計時**: 在時間控制啟用的情況下，第一步棋走出後開始計時
2. **倒數計時**: 每100毫秒更新一次顯示，確保流暢的倒數效果
3. **增加時間**: 每走一步棋後，該玩家的時間會增加設定的增量
4. **超時判負**: 當玩家時間歸零時，遊戲結束，對手獲勝
5. **新遊戲重置**: 點擊"新遊戲"按鈕會重置雙方時間為初始設定值

## 技術實現 (Technical Implementation)

### 新增的 UI 組件

- `QComboBox* m_timeLimitCombo` - 時間限制下拉選單
- `QSlider* m_incrementSlider` - 增量滑桿
- `QLabel* m_incrementLabel` - 增量數值顯示
- `QLabel* m_whiteTimeLabel` - 白方時間顯示
- `QLabel* m_blackTimeLabel` - 黑方時間顯示
- `QTimer* m_gameTimer` - 遊戲計時器 (100ms 間隔)

### 狀態變數

- `int m_whiteTimeMs` - 白方剩餘時間（毫秒）
- `int m_blackTimeMs` - 黑方剩餘時間（毫秒）
- `int m_incrementMs` - 增量時間（毫秒）
- `bool m_timeControlEnabled` - 時間控制是否啟用

### 核心方法

- `setupTimeControlUI()` - 建立時間控制 UI
- `updateTimeDisplays()` - 更新計時器顯示
- `onTimeLimitChanged()` - 處理時間限制變更
- `onIncrementChanged()` - 處理增量變更
- `onGameTimerTick()` - 計時器每次跳動的處理
- `startTimer()` - 啟動計時器
- `stopTimer()` - 停止計時器
- `applyIncrement()` - 應用增量時間
- `loadTimeControlSettings()` - 載入設定
- `saveTimeControlSettings()` - 儲存設定

## 使用說明 (Usage Instructions)

1. **設定時間控制**
   - 從"總時間"下拉選單選擇期望的時間限制
   - 使用"每著加秒"滑桿設定每步增加的時間
   - 選擇"無限制"則停用時間控制

2. **開始遊戲**
   - 點擊"新遊戲"按鈕重置棋盤和時間
   - 走第一步棋時，計時器自動開始

3. **進行遊戲**
   - 每次走棋後，計時器會切換到對手
   - 增量時間會自動加到剛走棋的玩家
   - 當前輪到的玩家計時器以綠色顯示

4. **遊戲結束**
   - 當玩家時間歸零時，會彈出對話框顯示結果
   - 可以點擊"新遊戲"開始新的對局

## 設定持久化 (Settings Persistence)

時間控制設定會自動儲存到 `Qt_Chess/TimeControl` 設定組中：
- `timeLimitSeconds` - 選擇的時間限制（秒）
- `incrementSeconds` - 選擇的增量（秒）

重新啟動應用程式時，會自動載入上次的設定。
