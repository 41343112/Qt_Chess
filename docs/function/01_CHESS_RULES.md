# 西洋棋規則與實現

## 功能概述

Qt_Chess 實現了完整的國際西洋棋規則（FIDE Rules），包括所有標準棋子的移動規則、將軍檢測和遊戲結束條件判定。

## 主要功能

### 1. 完整的棋子移動規則

#### 兵（Pawn）♙♟
- **基本移動**：向前移動一格
- **首次移動**：從起始位置可前進兩格
- **吃子方式**：斜向吃子（向前斜進一格）
- **限制**：只能向前移動，不能後退

#### 城堡（Rook）♖♜
- **移動方向**：水平或垂直
- **移動距離**：任意格數
- **限制**：路徑上不能有棋子阻擋

#### 騎士（Knight）♘♞
- **移動模式**：「L」形移動（2+1 或 1+2 格）
- **特殊能力**：可以跳過其他棋子
- **移動範圍**：最多 8 個位置

#### 主教（Bishop）♗♝
- **移動方向**：斜向
- **移動距離**：任意格數
- **限制**：路徑上不能有棋子阻擋
- **特性**：始終在同色方格上

#### 皇后（Queen）♕♛
- **移動方向**：水平、垂直、斜向
- **移動距離**：任意格數
- **特性**：結合城堡和主教的能力

#### 國王（King）♔♚
- **移動方向**：任何方向
- **移動距離**：每次一格
- **限制**：不能移入被將軍的位置

### 2. 遊戲規則

#### 回合制
- 白棋先走
- 雙方輪流行棋
- 每回合移動一個棋子

#### 走法驗證
遊戲自動驗證每步移動的合法性：
- 是否符合棋子移動規則
- 目標位置是否在棋盤內
- 是否吃掉己方棋子
- 路徑是否有阻擋
- 移動後國王是否安全

#### 將軍（Check）
- 國王受到直接威脅
- 被將軍時必須：
  1. 移動國王到安全位置
  2. 用其他棋子阻擋
  3. 吃掉攻擊者

#### 將死（Checkmate）
- 國王被將軍且無法逃脫
- 被將死方輸掉遊戲

#### 僵局（Stalemate）
- 輪到行動但無合法移動
- 國王未被將軍
- 結果為平局

#### 材料不足平局
- 單國王對單國王
- 國王+主教對國王
- 國王+騎士對國王

### 3. 視覺化提示

#### 移動標示
- **橙色方格**：可移動到的空位
- **紅色方格**：可吃子的位置
- **高亮顯示**：選中的棋子
- **移動痕跡**：上一步的起點和終點

#### 互動方式
1. **點擊移動**
   - 點擊棋子選擇
   - 點擊目標位置移動

2. **拖放移動**
   - 拖曳棋子到目標位置
   - 釋放滑鼠完成移動

3. **取消操作**
   - 再次點擊已選棋子
   - 按右鍵取消拖曳

## 使用方法

1. **開始遊戲**
   - 選擇遊戲模式（雙人/電腦/線上）
   - 白棋先手開始

2. **移動棋子**
   - 點擊或拖曳己方棋子
   - 選擇有效的目標位置

3. **遊戲進行**
   - 遵守回合制規則
   - 注意將軍提示
   - 避免違規移動

4. **遊戲結束**
   - 將死：勝負已分
   - 僵局：平局
   - 投降：手動認輸

## 技術實現

### 核心類別
- **ChessPiece**：棋子類別，定義類型、顏色和移動規則
- **ChessBoard**：棋盤類別，管理遊戲狀態和規則驗證
- **Qt_Chess**：主視窗類別，處理 UI 互動

### 移動驗證流程
```
使用者操作
    ↓
基本規則檢查
    ↓
路徑檢查
    ↓
將軍檢查
    ↓
執行移動或拒絕
```

## 相關文檔

- [02_SPECIAL_MOVES.md](02_SPECIAL_MOVES.md) - 特殊走法說明
- [03_GAME_MODES.md](03_GAME_MODES.md) - 遊戲模式介紹
- [12_MOVE_RECORDING.md](12_MOVE_RECORDING.md) - 棋譜記錄功能

## 程式碼參考

- `src/chesspiece.h/cpp` - 棋子定義和移動規則
- `src/chessboard.h/cpp` - 棋盤邏輯和遊戲規則
- `src/qt_chess.h/cpp` - UI 邏輯和視覺呈現
