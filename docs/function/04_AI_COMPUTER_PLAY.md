# AI 人機對弈

## 功能概述

Qt_Chess 整合 Stockfish 西洋棋引擎，提供強大的 AI 對手。玩家可以選擇執白或執黑與電腦對弈，並調整難度等級以匹配自己的技能水平。

## 主要功能

### 1. Stockfish 引擎整合

#### 引擎特點
- **Stockfish**：世界頂級開源西洋棋引擎
- **UCI 協議**：標準國際象棋引擎通訊協議
- **強大棋力**：從初學者到大師級別
- **快速響應**：智慧思考時間管理

#### 引擎位置
- 預設路徑：`engine/stockfish`
- 自動檢測系統架構
- 支援 Linux、Windows、macOS

### 2. 難度等級設定

#### 等級範圍
**0-20 級**，共 21 個等級

#### 等級分類
- **0-5 級**：初學者
  - 適合剛學會下棋的玩家
  - 經常犯錯，易被擊敗
  
- **6-10 級**：中級玩家
  - 適合有一定經驗的玩家
  - 偶爾犯錯，但有威脅性
  
- **11-15 級**：進階玩家
  - 適合經驗豐富的玩家
  - 很少犯錯，下棋有計劃性
  
- **16-20 級**：專家/大師級
  - 適合高級玩家
  - 幾乎不犯錯，下棋精確

#### 難度調整
- 使用介面上的「電腦難度」滑桿
- 即時調整，不需重啟
- 設定會自動儲存

### 3. 顏色選擇

#### 執白棋（預設）
- 玩家先手
- 白棋位於下方
- 棋盤正常方向

#### 執黑棋
- 電腦先手
- 黑棋位於下方
- 棋盤自動翻轉 180 度
- 從黑棋視角觀看

### 4. 思考提示

#### 電腦思考中
- 顯示「電腦思考中...」文字提示
- 防止玩家在電腦回合操作
- 可視化電腦回合狀態

#### 思考時間
- 根據難度自動調整
- 較低難度：快速回應
- 較高難度：深思熟慮

## 使用方法

### 開始 AI 對弈

1. **進入 AI 模式**
   ```
   主選單 → 點擊「電腦」按鈕
   ```

2. **選擇顏色**
   - 點擊「執白」：您先手，白棋在下
   - 點擊「執黑」：電腦先手，黑棋在下（棋盤翻轉）

3. **設定難度**
   - 拖動「電腦難度」滑桿
   - 數字越大，難度越高
   - 建議：初學者從 5 級開始

4. **設定時間**（可選）
   - 選擇總時間
   - 設定每著加秒
   - 詳見 [06_TIME_CONTROL.md](06_TIME_CONTROL.md)

5. **開始對局**
   - 執白：您先走
   - 執黑：等待電腦移動

### 對局進行

1. **玩家回合**
   - 選擇並移動棋子
   - 遵守所有規則
   - 完成移動後輪到電腦

2. **電腦回合**
   - 顯示「電腦思考中...」
   - 等待電腦計算最佳移動
   - 電腦自動移動棋子
   - 播放移動音效

3. **繼續對局**
   - 輪流進行直到遊戲結束
   - 可隨時「新遊戲」重新開始
   - 可使用「放棄」按鈕認輸

### 調整策略

#### 如果太難
- 降低難度等級
- 嘗試 0-5 級
- 重新開始遊戲

#### 如果太簡單
- 提高難度等級
- 嘗試 15-20 級
- 挑戰自己的極限

## 進階功能

### 棋力分析
不同等級對應的大致水平：
- **0-5 級**：~800-1200 Elo
- **6-10 級**：~1200-1600 Elo
- **11-15 級**：~1600-2000 Elo
- **16-20 級**：~2000-2400+ Elo

### 引擎設定
引擎內部參數（進階使用者）：
- **Skill Level**：控制下棋水平（0-20）
- **思考時間**：計算移動的時間限制
- **搜尋深度**：棋步預測的層數

### 學習建議

#### 初學者（0-5 級）
- 專注於基本走法
- 學習吃子機會
- 避免送子

#### 中級玩家（6-10 級）
- 發展開局理論
- 學習戰術組合
- 注意子力協調

#### 進階玩家（11-15 級）
- 深入開局準備
- 掌握中局戰術
- 練習殘局技巧

#### 高級玩家（16-20 級）
- 精細位置判斷
- 複雜戰術計算
- 深度戰略規劃

## 技術實現

### 引擎管理
```cpp
class ChessEngine : public QObject {
    bool startEngine(const QString& enginePath);
    void setDifficulty(int level);  // 0-20
    void requestMove();
    QString getBestMove() const;
};
```

### UCI 通訊
```cpp
// 設定難度
sendCommand("setoption name Skill Level value " + level);

// 請求移動
sendCommand("position fen " + currentFEN);
sendCommand("go movetime " + thinkingTime);

// 接收最佳移動
// bestmove e2e4
```

### FEN 轉換
```cpp
QString boardToFEN(const ChessBoard& board);
QString moveToUCI(const QPoint& from, const QPoint& to);
void uciToMove(const QString& uci, QPoint& from, QPoint& to);
```

## 相關文檔

- [03_GAME_MODES.md](03_GAME_MODES.md) - 遊戲模式介紹
- [01_CHESS_RULES.md](01_CHESS_RULES.md) - 西洋棋規則
- [06_TIME_CONTROL.md](06_TIME_CONTROL.md) - 時間控制
- [11_BOARD_FLIP.md](11_BOARD_FLIP.md) - 棋盤翻轉

## 程式碼參考

- `src/chessengine.h/cpp` - 引擎整合和 UCI 通訊
- `src/qt_chess.cpp` - AI 模式 UI 邏輯
- `engine/stockfish` - Stockfish 引擎執行檔

## 疑難排解

### 引擎無法啟動
- 檢查 `engine/stockfish` 是否存在
- 確認檔案有執行權限
- 查看錯誤訊息

### 電腦不移動
- 檢查是否顯示「電腦思考中...」
- 確認未處於回放模式
- 嘗試重新開始遊戲

### 難度調整無效
- 開始新遊戲後生效
- 檢查滑桿數值是否改變
- 重啟程式試試
