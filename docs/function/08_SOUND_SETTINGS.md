# 音效設定

## 功能概述

Qt_Chess 提供完整的音效自訂功能，允許使用者為每種遊戲事件設定自訂音效檔案，調整音量，以及個別啟用/停用音效。

## 主要功能

### 1. 自訂音效檔案

#### 支援的音效類型
可為以下事件設定自訂音效：
- **移動音效** - 普通移動棋子
- **吃子音效** - 吃掉對方棋子
- **王車易位音效** - 執行王車易位
- **將軍音效** - 國王被將軍
- **將死音效** - 遊戲結束

#### 支援的音訊格式
- **WAV** ✅ 推薦（最佳相容性）
- **MP3** ✅ 支援
- **OGG** ✅ 支援
- **其他** ⚠️ 依平台而定

#### 選擇音效檔案
- 點擊「瀏覽」按鈕
- 從檔案系統選擇音效檔
- 支援絕對路徑
- 自動驗證格式

### 2. 音量調整

#### 獨立音量控制
每種音效都有獨立的音量滑桿：
- **範圍**：0-100%
- **即時顯示**：滑桿旁顯示百分比
- **精細調整**：1% 精度
- **即時生效**：立即應用新音量

#### 音量設定
- 拖動滑桿調整
- 顯示當前百分比
- 0% = 靜音
- 100% = 最大音量

### 3. 啟用/停用控制

#### 全域開關
- **啟用所有音效**：主開關
- 一鍵開啟/關閉所有音效
- 快速靜音功能

#### 個別開關
每種音效都有獨立的核取方塊：
- ☑️ 已勾選 = 啟用
- ☐ 未勾選 = 停用
- 獨立控制每種音效
- 靈活組合

#### 聯動關係
- 關閉「全域開關」→ 所有音效停用
- 開啟「全域開關」→ 恢復個別設定
- 個別開關不影響其他音效

### 4. 預覽功能

#### 試聽音效
每種音效旁都有「預覽」按鈕：
- 點擊播放當前設定的音效
- 使用設定的音量播放
- 套用前確認效果
- 無需進入遊戲測試

#### 預覽用途
- 確認音效檔案正確
- 測試音量是否合適
- 比較不同音效
- 調整到滿意為止

### 5. 重設功能

#### 個別重設
每種音效都有「重設」按鈕：
- 恢復該音效的預設設定
- 包括預設檔案和音量
- 不影響其他音效

#### 全域重設
「重設為預設值」按鈕：
- 恢復所有音效到預設
- 清除所有自訂設定
- 恢復預設音量（50%）
- 啟用所有音效

### 6. 設定持久化

#### 自動儲存
- 點擊「確定」後儲存所有設定
- 關閉程式後保留
- 下次啟動自動載入

#### 儲存內容
- 自訂音效檔案路徑
- 每種音效的音量
- 啟用/停用狀態
- 全域開關狀態

## 使用方法

### 開啟音效設定

```
選單列 → 設定 → 音效設定
```

### 設定自訂音效

1. **選擇音效類型**
   - 找到要更換的音效（如「移動音效」）

2. **瀏覽音效檔案**
   - 點擊該音效的「瀏覽」按鈕
   - 在檔案對話框中選擇音效檔
   - 支援 WAV、MP3、OGG 格式

3. **預覽音效**
   - 點擊「預覽」按鈕試聽
   - 確認音效符合預期

4. **調整音量**
   - 拖動音量滑桿
   - 觀察百分比顯示
   - 再次預覽確認

5. **套用設定**
   - 點擊「確定」按鈕
   - 設定立即生效並儲存

### 調整音量

1. **找到音量滑桿**
   - 每種音效下方都有音量控制

2. **拖動調整**
   - 向左減小音量
   - 向右增大音量
   - 顯示當前百分比

3. **預覽測試**
   - 調整後點擊「預覽」
   - 確認音量合適

4. **儲存設定**
   - 點擊「確定」儲存

### 啟用/停用音效

#### 停用所有音效
```
取消勾選「啟用所有音效」→ 確定
```

#### 停用特定音效
```
取消勾選該音效的核取方塊 → 確定
```

#### 恢復音效
```
重新勾選相應核取方塊 → 確定
```

### 恢復預設設定

#### 重設單一音效
```
點擊該音效的「重設」按鈕 → 確定
```

#### 重設所有音效
```
點擊「重設為預設值」按鈕 → 確定
```

## 音效設定對話框

### 對話框佈局

```
╔══════════════════════════════════════╗
║       音效設定                        ║
╠══════════════════════════════════════╣
║ ☑ 啟用所有音效                        ║
║                                      ║
║ 移動音效                              ║
║ ☑ [路徑] [瀏覽] [預覽] [重設]         ║
║ 音量: [====│----] 50%                ║
║                                      ║
║ 吃子音效                              ║
║ ☑ [路徑] [瀏覽] [預覽] [重設]         ║
║ 音量: [====│----] 50%                ║
║                                      ║
║ ... (其他音效) ...                    ║
║                                      ║
║ [重設為預設值] [取消] [確定]          ║
╚══════════════════════════════════════╝
```

### 界面元素

#### 每種音效的控制項
1. **核取方塊** - 啟用/停用該音效
2. **路徑顯示** - 顯示當前音效檔案
3. **瀏覽按鈕** - 選擇新的音效檔案
4. **預覽按鈕** - 試聽當前音效
5. **重設按鈕** - 恢復預設
6. **音量滑桿** - 調整音量（0-100%）
7. **音量標籤** - 顯示當前百分比

#### 底部按鈕
- **重設為預設值** - 恢復所有預設設定
- **取消** - 放棄更改，關閉對話框
- **確定** - 儲存設定並關閉

## 進階使用

### 創建自訂音效集

1. **準備音效檔案**
   - 收集或製作音效
   - 轉換為 WAV 格式（推薦）
   - 調整音效長度（0.5-2 秒）

2. **統一音量**
   - 使用音訊編輯軟體
   - 標準化音效音量
   - 避免音量差異過大

3. **逐一設定**
   - 依次設定每種音效
   - 預覽確認效果
   - 調整音量平衡

4. **儲存設定**
   - 點擊「確定」
   - 測試遊戲中效果
   - 必要時微調

### 音效檔案建議

#### 移動音效
- 輕柔、短促
- 不刺耳
- 0.3-0.5 秒

#### 吃子音效
- 較重、明顯
- 區別於移動
- 0.5-1 秒

#### 王車易位音效
- 特殊、識別度高
- 與其他音效不同
- 0.5-1 秒

#### 將軍音效
- 警示性
- 引起注意
- 0.5-1 秒

#### 將死音效
- 終局感
- 較長較完整
- 1-2 秒

## 技術實現

### 設定結構
```cpp
struct SoundSettings {
    QString moveSound;
    QString captureSound;
    QString castlingSound;
    QString checkSound;
    QString checkmateSound;
    
    double moveVolume;
    double captureVolume;
    double castlingVolume;
    double checkVolume;
    double checkmateVolume;
    
    bool moveSoundEnabled;
    bool captureSoundEnabled;
    bool castlingSoundEnabled;
    bool checkSoundEnabled;
    bool checkmateSoundEnabled;
    bool allSoundsEnabled;
};
```

### 設定載入與儲存
```cpp
void loadSettings() {
    QSettings settings;
    m_settings.moveSound = settings.value("sound/move", "qrc:/sounds/move.wav").toString();
    m_settings.moveVolume = settings.value("sound/moveVolume", 0.5).toDouble();
    m_settings.moveSoundEnabled = settings.value("sound/moveEnabled", true).toBool();
    // ... 其他設定
}

void saveSettings() {
    QSettings settings;
    settings.setValue("sound/move", m_settings.moveSound);
    settings.setValue("sound/moveVolume", m_settings.moveVolume);
    settings.setValue("sound/moveEnabled", m_settings.moveSoundEnabled);
    // ... 其他設定
}
```

### 預覽播放
```cpp
void previewSound(const QString& soundFile, double volume) {
    m_previewSound.stop();
    m_previewSound.setSource(QUrl::fromLocalFile(soundFile));
    m_previewSound.setVolume(volume);
    m_previewSound.play();
}
```

## 相關文檔

- [07_SOUND_EFFECTS.md](07_SOUND_EFFECTS.md) - 音效系統概述
- [01_CHESS_RULES.md](01_CHESS_RULES.md) - 遊戲規則
- [02_SPECIAL_MOVES.md](02_SPECIAL_MOVES.md) - 特殊走法音效

## 程式碼參考

- `src/soundsettingsdialog.h/cpp` - 音效設定對話框
- `src/qt_chess.cpp` - 音效設定整合

## 疑難排解

### 自訂音效無法播放
- 確認音效檔案格式支援
- 檢查檔案路徑是否正確
- 確認檔案未損壞
- 嘗試使用 WAV 格式

### 音量調整無效
- 檢查系統音量
- 確認音效已啟用
- 重新開啟設定對話框
- 重啟應用程式

### 設定未儲存
- 確認點擊「確定」而非「取消」
- 檢查應用程式寫入權限
- 查看設定檔是否存在
- 嘗試手動刪除設定檔重新配置

### 預覽功能無反應
- 確認音效檔案存在
- 檢查音訊驅動程式
- 確認系統未靜音
- 重啟應用程式
