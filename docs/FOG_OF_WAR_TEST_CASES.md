# 霧戰模式驗證測試案例

## 測試案例 1：初始棋盤狀態

### 預期行為
在遊戲開始時，白方應該能看到：
- 所有白方棋子的位置（第 6、7 行）
- 白方兵可以移動到的位置（第 5 行和第 4 行）
- 白方騎士可以跳到的位置
- 其他所有位置應該顯示為霧狀

黑方應該看到對稱的視野（第 0、1 行的黑方棋子及其可移動範圍）

### 具體視野範圍（白方初始視角）
- Row 7: 全部可見（白方底線棋子）
- Row 6: 全部可見（白方兵）
- Row 5: 全部可見（兵可以移動一格）
- Row 4: 部分可見（兵可以移動兩格，僅限初始移動）
- Row 3-0: 霧狀（超出白方棋子視野）

例外：
- b1 和 g1 位置可見（白方騎士可以跳到 a3, c3, f3, h3）
- 所以 a3, c3, f3, h3 也會可見

## 測試案例 2：兵向前移動

### 動作
白方移動 e2 兵到 e4

### 預期行為
- e4 位置變為可見（兵現在在這裡）
- e5 和 e6 變為可見（兵可以向前移動）
- e3 保持可見（兵曾經在這個路徑上）
- d5, f5 變為可見（兵可以斜向吃子）
- 黑方輪次時，視角切換到黑方視野

## 測試案例 3：騎士跳躍

### 動作
白方移動 g1 騎士到 f3

### 預期行為
- f3 位置變為可見（騎士現在在這裡）
- 騎士的新可移動位置變為可見：
  - d2, e1, g1 (已經可見)
  - d4, e5, g5, h4 (新增可見)
- g1 位置保持可見（因為國王旁邊）

## 測試案例 4：線上對戰模式

### 場景
- 玩家 A（房主）執白
- 玩家 B（房客）執黑
- 雙方都選擇了霧戰模式

### 預期行為
玩家 A 的畫面：
- 只顯示白方視野
- 即使是黑方回合，玩家 A 仍然只看到白方視野
- 黑方的棋子只有在白方視野範圍內才可見

玩家 B 的畫面：
- 只顯示黑方視野
- 即使是白方回合，玩家 B 仍然只看到黑方視野
- 白方的棋子只有在黑方視野範圍內才可見

## 測試案例 5：將軍狀態

### 場景
黑方的皇后移動到能攻擊白方國王的位置

### 預期行為
- 如果白方能看到黑方皇后（在視野範圍內），白方國王會被高亮為紅色
- 如果白方看不到黑方皇后（在霧中），白方國王仍會被高亮為紅色（遊戲規則提示）
- 白方只能移動能解除將軍的棋子
- 即使看不到攻擊源，遊戲也會阻止白方進行無效移動

## 測試案例 6：視野邊界

### 場景
白方城堡在 a1，黑方兵在 a7

### 預期行為
- 白方應能看到 a1-a8 整列（城堡的移動範圍）
- 白方能看到 a7 的黑方兵（因為在城堡視野內）
- 如果 a5 有黑方棋子，白方只能看到 a1-a5（城堡被阻擋）
- a6-a8 變為霧狀（城堡無法越過 a5 的棋子）

## 測試案例 7：不啟用霧戰模式

### 場景
創建遊戲但不選擇霧戰模式

### 預期行為
- 所有棋子都應該正常顯示
- 沒有任何霧狀效果
- 棋盤顏色正常
- 遊戲功能不受影響

## 手動測試步驟

### 本地測試
```
1. 啟動 Qt_Chess
2. 點擊「線上遊玩」
3. 點擊「創建房間」
4. 勾選「🌫️ 霧戰」
5. 點擊「確定」
6. 觀察棋盤：
   - 第 7、6 行應該清晰可見
   - 第 5、4 行部分可見（兵的移動範圍）
   - 第 3、2、1、0 行應該顯示霧狀 🌫
7. 移動一個兵（例如 e2 到 e4）
8. 觀察視野變化
9. 觀察黑方回合時視角是否切換
```

### 線上測試（需要兩個客戶端）
```
客戶端 1（房主）：
1. 創建房間並選擇霧戰模式
2. 複製房號
3. 等待對手加入
4. 觀察只能看到白方視野

客戶端 2（房客）：
1. 加入房間
2. 觀察只能看到黑方視野
3. 即使白方移動後，仍然只看到黑方視野
```

## 驗證清單

- [ ] 初始棋盤狀態下視野正確
- [ ] 兵移動後視野更新正確
- [ ] 騎士跳躍後視野更新正確
- [ ] 線上模式下雙方視角獨立
- [ ] 本地模式下視角輪流切換
- [ ] 不啟用霧戰時遊戲正常
- [ ] 霧狀方格顯示正確（深灰色 + 🌫 符號）
- [ ] 可見方格顯示正確（正常棋盤顏色 + 棋子）
- [ ] 將軍高亮在霧戰模式下仍然工作
- [ ] 城堡和主教的長距離視野正確計算

## 已知的正確行為

1. **視野是基於合法移動計算的**：即使一個棋子在視野中，如果移動到那裡會導致自己的國王被將軍，那個位置仍然可見（因為棋子理論上可以"看到"那個位置，只是不能移動到那裡）。

2. **對方棋子阻擋視野**：如果一個遠程棋子（城堡、主教、皇后）的視線被對方棋子阻擋，視野會在該棋子處停止，無法看到後面的方格。

3. **重複的方格**：`getVisibleSquaresForColor()` 可能會將同一個方格添加多次（如果多個棋子都能移動到那裡），但這不影響功能，因為我們只檢查方格是否在列表中。
